/*
 * stickyNavbar.js v1.3.1
 * https://github.com/jbutko/stickyNavbar.js
 * Fancy sticky navigation jQuery plugin with smart anchor links highlighting
 *
 * Developed and maintained under MIT license by Jozef Butko - www.jozefbutko.com
 * http://www.opensource.org/licenses/MIT
 *
 * Original jquery-browser code Copyright 2005, 2014 jQuery Foundation, Inc. and other contributors
 * http://jquery.org/license
 *
 * CREDITS:
 * Daniel Eden for Animate.CSS:
 * http://daneden.github.io/animate.css/
 * jQuery easing plugin:
 * http://gsgd.co.uk/sandbox/jquery/easing/
 *
 * COPYRIGHT (C) 2014 Jozef Butko
 * https://github.com/jbutko
 * LAST UPDATE: 06/06/2015
 *
 */
(function ($, window, document) {
    "use strict";
    
    $.fn.stickyNavbar = function (options) {
        var settings = $.extend({
            activeClass: "active",
            sectionSelector: "scrollto",
            animDuration: 750,
            startAt: 0,
            easing: "swing",
            animateCSS: true,
            animateCSSRepeat: false,
            cssAnimation: "fadeIn",
            jqueryEffects: false,
            jqueryAnim: "slideDown",
            selector: "a",
            mobile: false,
            mobileWidth: 480,
            zindex: 9999,
            stickyModeClass: "sticky",
            unstickyModeClass: "unsticky"
        }, options);
        
        var sections = $("." + settings.sectionSelector);
        sections.attr("tabindex", -1);
        
        return this.each(function () {
            var navbar = $(this),
                originalPosition = navbar.css("position"),
                originalZIndex = navbar.css("zIndex"),
                navbarHeight = navbar.outerHeight(true),
                offsetTop = navbar.offset().top - navbarHeight,
                topPosition = navbar.css("top") === "auto" ? 0 : navbar.css("top"),
                menuItems = navbar.find(settings.selector === "a" ? "li a" : "li");
                
                menuItems.click(function (event) {
                    var target = settings.selector === "li"
                        ? $(this).children("a").attr("href")
                        : $(this).attr("href");
                
                    // If link matches http/https/mailto/leading slash, OR does NOT start with "#"
                    // â†’ Let the browser handle it normally (return true).
                    if (/^(http|https|mailto:|\/)/.test(target) || target[0] !== '#') {
                        return true;
                    }
                
                    // Otherwise, it's an in-page anchor (e.g. "#about"), so do smooth scroll:
                    event.preventDefault();
                    var targetId = target.substr(1);
                    var targetOffset = $("#" + targetId).offset().top - navbarHeight + 2;
                
                    $("html, body").stop().animate({
                        scrollTop: targetOffset
                    }, {
                        duration: settings.animDuration,
                        easing: settings.easing,
                        complete: function () {
                            document.getElementById(targetId).focus();
                        }
                    });
                });
                
            
            var updateNavbar = function () {
                var scrollTop = $(window).scrollTop(),
                    windowWidth = $(window).width(),
                    windowHeight = $(window).height();
                
                if (!settings.mobile && windowWidth < settings.mobileWidth) {
                    navbar.css("position", originalPosition);
                    return;
                }
                
                menuItems.removeClass(settings.activeClass);
                sections.each(function () {
                    var sectionOffset = $(this).offset().top - navbarHeight,
                        sectionHeight = $(this).outerHeight(true) + sectionOffset;
                    
                    if (scrollTop >= sectionOffset && sectionHeight >= scrollTop) {
                        navbar.find('li a[href~="#' + this.id + '"]').addClass(settings.activeClass);
                    }
                });
                
                if (scrollTop >= offsetTop + settings.startAt) {
                    navbar.removeClass(settings.unstickyModeClass).addClass(settings.stickyModeClass);
                    navbar.css({ position: "fixed", zIndex: settings.zindex }).stop();
                    
                    if (settings.jqueryEffects) {
                        if (settings.animateCSSRepeat) {
                            navbar.hide().stop()[settings.jqueryAnim](settings.animDuration, settings.easing);
                        } else {
                            navbar.hide().stop()[settings.jqueryAnim](settings.animDuration, settings.easing);
                        }
                    } else if (settings.animateCSS) {
                        if (settings.animateCSSRepeat) {
                            navbar.addClass(settings.cssAnimation + " animated").one("animationend webkitAnimationEnd MSAnimationEnd oAnimationEnd", function () {
                                navbar.removeClass(settings.cssAnimation + " animated");
                            });
                        } else {
                            navbar.addClass(settings.cssAnimation + " animated").one("animationend webkitAnimationEnd MSAnimationEnd oAnimationEnd");
                        }
                    } else {
                        navbar.stop();
                    }
                } else {
                    navbar.css({ position: originalPosition, zIndex: originalZIndex });
                    navbar.removeClass(settings.stickyModeClass).addClass(settings.unstickyModeClass);
                }
            };
            
            $(window).scroll(updateNavbar);
            $(window).ready(updateNavbar);
            $(window).resize(updateNavbar);
            $(window).load(updateNavbar);
        });
    };
})(jQuery, window, document);
